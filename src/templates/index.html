<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pumpkin Man Controls</title>
</head>
<body>
<h1>Pumpkin Man Controls</h1>
<button onclick="startRecording()" id="startRecordingButton">Start Recording</button>
<button disabled onclick="stopRecording()" id="stopRecordingButton">Stop Recording</button>
<br>
<form method="post" enctype="multipart/form-data" action="{{ url_for('upload_recording') }}">
    <input type="file" accept=".rec,application/octet-stream" name="recording" required>
    <button type="submit">Upload</button>
</form>
<button onmousedown="openMouth()" onmouseup="closeMouth()" style="width: 40em; height: 30em;" id="mouth-button">
    Open Mouth
</button>
<br>
<button onclick="startAudio()">Start Audio</button>
<button onclick="stopAudio()">Stop Audio</button>
<br>
<label>Threshold<input type="number" id="threshold" value="-19"></label>
<br>
<label>Require increasing amplitude<input type="checkbox" id="increasing-box"></label>
<br>
<label>Minimum mouth open time (ms)<input type="number" id="min-open-time" value="50"></label>
<br>
<div id="recording-meter" style="height: 10rem; margin: 1rem 0; width: 4rem;"></div>
<script>
    const webSocket = new WebSocket('{{ url_for("ws") }}');
    const recordingBaseUrl = '{{ url_for('download_recording', identifier='REPLACEME') }}';
    webSocket.onclose = _ => window.setTimeout(() => location.reload(), 1000);
</script>
<script src="{{ url_for('static', filename='ws-listener.js') }}"></script>
<script src="{{ url_for('static', filename='mouth.js') }}"></script>
<script src="{{ url_for('static', filename='kaliatech-web-audio-recording-tests-simpler/js/encoder-wav-worker.js') }}"></script>
<script src="{{ url_for('static', filename='kaliatech-web-audio-recording-tests-simpler/js/RecorderService.js') }}"></script>
<script src="{{ url_for('static', filename='kaliatech-web-audio-recording-tests-simpler/js/WebAudioPeakMeter.js') }}"></script>
<script src="{{ url_for('static', filename='audio.js') }}"></script>
<script src="{{ url_for('static', filename='recording.js') }}"></script>
</body>
</html>
